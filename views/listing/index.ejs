<% layout('layouts/boilerplate') %>

<div class="container mb-5">
  
  <!-- Add search results header -->
  <% if (typeof searchQuery !== 'undefined' && searchQuery) { %>
    <div class="alert alert-info d-flex justify-content-between align-items-center" role="alert">
      <span>
        <i class="fa-solid fa-search"></i>
        Showing results for: <strong>"<%= searchQuery %>"</strong>
        (<%= allListing.length %> found)
      </span>
      <a href="/listing" class="btn btn-sm btn-outline-secondary">
        <i class="fa-solid fa-times"></i> Clear Search
      </a>
    </div>
  <% } %>

  <div class="filter-container">
    <button id="slideLeft" class="slide-btn">‹</button>

    <div id="filters">
      <div class="filter">
        <i class="fa-solid fa-fire"></i>
        <p class="filter-text">Trending</p>
      </div>
      <div class="filter">
        <i class="fa-solid fa-bed"></i>
        <p class="filter-text">Beds</p>
      </div>
      <div class="filter">
        <i class="fa-solid fa-volcano"></i>
        <p class="filter-text">Mountain</p>
      </div>
      <div class="filter">
        <i class="fa-solid fa-chess"></i>
        <p class="filter-text">Castle</p>
      </div>
      <div class="filter">
        <i class="fa-solid fa-person-swimming"></i>
        <p class="filter-text">Amazing Pool</p>
      </div>
      <div class="filter">
        <i class="fa-solid fa-tent"></i>
        <p class="filter-text">Camping</p>
      </div>
      <div class="filter">
        <i class="fa-solid fa-tree"></i>
        <p class="filter-text">Nature</p>
      </div>
      <div class="filter">
        <i class="fa-solid fa-tractor"></i>
        <p class="filter-text">Farm</p>
      </div>
      <div class="filter">
        <i class="fa-solid fa-snowflake"></i>
        <p class="filter-text">Snow</p>
      </div>
    </div>

    <button id="slideRight" class="slide-btn">›</button>
  </div>

  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
    <% if (allListing.length > 0) { %>
      <% for (let listing of allListing) { %>
      <div class="col">
        <div
          class="card h-100 listing-card border-0 shadow-sm"
          onclick="window.location.href='/listing/<%= listing._id %>'"
          role="button"
          tabindex="0"
        >
          <div class="image-container">
            <img
              src="<%= listing.image.url %>"
              class="card-img-top"
              alt="<%= listing.title %>"
              loading="lazy"
            />
          </div>
          <div class="card-body d-flex flex-column p-3">
            <h5
              class="card-title mb-2 text-truncate"
              title="<%= listing.title %>"
            >
              <%= listing.title %>
            </h5>
            <p class="text-muted small mb-1">
              <i class="fa-solid fa-location-dot"></i>
              <%= listing.location %>, <%= listing.country %>
            </p>
            <p class="price-tag mb-0 mt-auto">
              <span class="fw-bold text-dark"
                >&#8377;<%= listing.price.toLocaleString('en-IN') %></span
              >
              <span class="text-muted">/night</span>
            </p>
          </div>
        </div>
      </div>
      <% } %>
    <% } else { %>
      <div class="col-12 text-center py-5">
        <i class="fa-solid fa-search fa-3x text-muted mb-3"></i>
        <h4 class="text-muted">No listings found</h4>
        <p class="text-muted">Try searching with different keywords</p>
        <a href="/listing" class="btn btn-primary mt-3">View All Listings</a>
      </div>
    <% } %>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const filters = document.getElementById('filters');
    const slideLeft = document.getElementById('slideLeft');
    const slideRight = document.getElementById('slideRight');

    if (slideLeft && slideRight && filters) {
      slideLeft.addEventListener('click', function() {
        filters.scrollBy({
          left: -200,
          behavior: 'smooth'
        });
      });

      slideRight.addEventListener('click', function() {
        filters.scrollBy({
          left: 200,
          behavior: 'smooth'
        });
      });
    }
  });
</script>
